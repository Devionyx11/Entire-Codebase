local AqhKfmBtPzx = game:GetService("GuiService")
local QrnVysJlCwd = game:GetService("Players")

getgenv().WxvHdsNmKyu = false

if not game:IsLoaded() then
    game.Loaded:Wait()
end

AqhKfmBtPzx.ErrorMessageChanged:Connect(function()
    local BhjLzpXqYwv, CndFtoMvKsr = pcall(function()
        return AqhKfmBtPzx:GetErrorCode()
    end)

    if BhjLzpXqYwv and CndFtoMvKsr then
        local YkgJrqDkPvo = tostring(CndFtoMvKsr):lower()
        if YkgJrqDkPvo:find("lost connection") or YkgJrqDkPvo:find("disconnected") then
            getgenv().WxvHdsNmKyu = true
        end
    end
end)

local function FkmNybGqJhv(MvpZtlKxDso)
    if writefile then
        local XrhPjoLqWvz = "Unknown"
        if QrnVysJlCwd.LocalPlayer then
            XrhPjoLqWvz = QrnVysJlCwd.LocalPlayer.Name
        end
        local TvgDsmNfKuy = "FS-Kryuss_" .. XrhPjoLqWvz .. ".txt"
        pcall(function()
            writefile(TvgDsmNfKuy, MvpZtlKxDso .. ":" .. tostring(os.time()))
        end)
    end
end

FkmNybGqJhv("working")

while not getgenv().WxvHdsNmKyu do
    FkmNybGqJhv("working")
    task.wait(1)
end

FkmNybGqJhv("disconnected")
